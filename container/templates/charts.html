{% extends 'base.html' %}

{% block title %}
    Charts - SkillTrail Analytics
{% endblock %}

{% block content %}
<div class="container-fluid bg-dark text-light py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-chart-bar"></i> Learning Analytics Dashboard
            </h2>
        </div>
    </div>

    <!-- Chart 1: Skills Progress Overview -->
    <div class="row mb-4">
        <div class="col-lg-6 offset-lg-3">
            <div class="card bg-light text-dark">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Skills Progress Overview</h5>
                </div>
                <div class="card-body">
                    <canvas id="progressChart" width="300" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart 2: Learning Trends -->
    <div class="row mb-4">
        <div class="col-lg-10 offset-lg-1">
            <div class="card bg-light text-dark">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Learning Trends (Last 30 Days)</h5>
                </div>
                <div class="card-body">
                    <canvas id="trendsChart" width="400" height="150"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart 3: Category Breakdown -->
    <div class="row mb-4">
        <div class="col-lg-8 offset-lg-2">
            <div class="card bg-light text-dark">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Hours by Category</h5>
                </div>
                <div class="card-body">
                    <canvas id="categoryChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      //Get data from Flask backend
      const chartsData = {{ charts_data|tojson }}; 
      
      
      //Chart 1: 'Skills Progress Overview
      const progress_ctx = document.getElementById('progressChart');
      
        chart = new Chart(progress_ctx, {
          type: 'doughnut',
          data: {
            labels: chartsData.progress_overview.labels,
            datasets: [{
              data: chartsData.progress_overview.data,
              backgroundColor: [
                  '#FF6B6B',  // Beginner - Red
                  'khaki',  // Intermediate - Teal  
                  '#45B7D1',  // Advanced - Blue
                  '#96CEB4' ],  // Completed - Green
        
              borderColor: '#fff',
              borderWidth: 2
            }]
          },

          options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 20,
                usePointStyle: true
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = total > 0 ? Math.round((context.parsed / total) * 100) : 0;
                  return context.label + ': ' + context.parsed + ' skills (' + percentage + '%)';
                }
              }
            }
          }
        }
      });



      //Chart 2: Learning trend - hours over time
      const trends_ctx = document.getElementById('trendsChart');
      
        chart = new Chart(trends_ctx, {
          type: 'line',
          data: {
            labels: chartsData.learning_trends.labels,
            datasets: [{
              label: 'Hours Spent',
              data: chartsData.learning_trends.data,
              backgroundColor: 'rgba(78, 205, 196, 0.1)',        
              borderColor: '#4ECDC4',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: '#4ECDC4',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 4
            }]
          },

          options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display : true,
                text: 'Hours'
              }
            },
            x: {
              title : {
                display: true,
                text: 'Date'
              }
            }
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          }
        }
      });



      //Chart 3: Category Breakdown (Bar) - hours per skill category
      const category_ctx = document.getElementById('categoryChart');
      
      const colors = [
                    '#FF6B6B',
                    '#4ECDC4',
                    '#45B7D1',
                    '#96CEB4',
                    '#FECA57',
                    '#FF9FF3',
                    '#54A0FF']

        chart = new Chart(category_ctx, {
          type: 'bar',
          data: {
            labels: chartsData.category_breakdown.labels,
            datasets: [{
              label: 'Hours Spent',
              data: chartsData.category_breakdown.data,
              backgroundColor: colors.slice(0,chartsData.category_breakdown.labels.length),    
              borderColor: '#4ECDC4',
              borderWidth: 2,
              fill: true,
              borderRadius: 8,
              borderSkipped: false
            }]
          },

          options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display : true,
                text: 'Total Hours'
              }
            },
            x: {
              title : {
                display: true,
                text: 'Skill Categories '
              }
            }
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + ' hours';
                }
              }
            }
          }
        }
      });





    </script>

{% endblock %}
